{% requireLogin %}

{# Notice updates #}
{% set updatedQueryString = craft.app.request.getQueryParam('updated', false) %}
{% if updatedQueryString and updatedQueryString == 'cardadded' %}
  {% do craft.app.session.setFlash('notice', 'Card added'|t) %}
{% elseif updatedQueryString and updatedQueryString == 'carddeleted' %}
  {% do craft.app.session.setFlash('notice', 'Card deleted'|t) %}
{% elseif updatedQueryString and updatedQueryString == 'address' %}
  {% do craft.app.session.setFlash('notice', 'Address updated'|t) %}
{% elseif updatedQueryString and updatedQueryString == 'addressadded' %}
  {% do craft.app.session.setFlash('notice', 'Address added'|t) %}
{% elseif updatedQueryString and updatedQueryString == 'addressdeleted' %}
  {% do craft.app.session.setFlash('notice', 'Address deleted'|t) %}
{% endif %}

{# Layout #}
{% extends '_layouts/site' %}

{# Variables #}
{% set customer = craft.commerce.customers.getCustomer() %}

{# Blocks #}
{% block content %}
  <!-- Template: {{ _self }}.twig -->
  <div class="bg-gray-100 py-8">
    <div class="max-w-4xl mx-auto space-y-6">
      <h1 class="text-4xl text-center">{{ 'Account'|t }}</h1>
    </div>
  </div>

  <div class="container flex justify-center">
    <div class="w-full max-w-4xl">
      {# Account Settings #}
      <div class="py-6 flex flex-wrap w-full">
        <div class="w-full pb-4 md:pb-0 md:w-1/3">
          <h2 class="text-2xl">{{ 'Email & Password'|t }}</h2>
        </div>
        <div class="w-full md:w-2/3 space-y-2 md:pr-16">
          Fields
        </div>
      </div>

      {# Card Management #}
      <div class="py-6 flex flex-wrap w-full border-t border-gray-300">
        <div class="w-full pb-4 md:pb-0 md:w-1/3">
          <h2 class="text-2xl">{{ 'Credit Cards'|t }}</h2>
        </div>
        <div class="w-full md:w-2/3 md:pr-16 relative">
          {{ sprig('_includes/components/payment/sourcesList', {}, {
            id: 'payment-sources-list',
            's-include': '#payment-sources-list',
            's-indicator': '#payment-sources-loading'
          }) }}
          <div id="payment-sources-indicator" class="spinner-overlay">
            {% include '_includes/components/spinner' %}
          </div>
        </div>
      </div>

      {# Address Management #}
      <div class="py-6 flex flex-wrap w-full border-t border-gray-300">
        <div class="w-full pb-4 md:pb-0 md:w-1/3">
          <h2 class="text-2xl">{{ 'Addresses'|t }}</h2>
        </div>

        <div class="w-full md:w-2/3 md:pr-16">
          {{ sprig('_includes/components/address/list', {}, {
            id: 'address-list',
            's-include': '#address-list'
          }) }}
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% js at endBody %}
  {% if updatedQueryString %}
    window.quickReplaceUri = '{{ entry.url }}';
  {% endif %}
{% endjs %}