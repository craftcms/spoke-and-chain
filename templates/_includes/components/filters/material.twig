<!-- Template: {{ _self }}.twig -->
{# Macros #}
{% import '_includes/macros' as _macros %}
{% spaceless %}
  {# Params #}
  {% set materials = materials is not defined ? [] : materials %}
  {% set heading = heading is not defined ? null : heading %}
  {% set showHeading = showHeading is not defined ? false : showHeading %}
  {% set urlFilterParams = urlFilterParams is not defined ? {material: []} : urlFilterParams %}

  {# Variables #}
  {% set url = craft.app.request.getUrl()|replace('?' ~ craft.app.request.getQueryString(), '') %}
  {% set selectedMaterials = urlFilterParams.material %}
{% endspaceless %}

{# Output #}
{% if materials|length %}
  {% if heading and showHeading %}
    <h4>{{ heading }}</h4>
  {% endif %}
  <ul>
    {% for materialCategory in materials -%}
      {%- set materialParams = (materialCategory.slug in selectedMaterials ? selectedMaterials : selectedMaterials|merge([materialCategory.slug])) -%}
      {%- set filterParams = urlFilterParams|merge({ material: materialParams }) -%}
      <li class="relative">
        <a href="{{ _macros.filterSiteUrl(url, filterParams) }}">
          {{ materialCategory.title }}{{ materialCategory.slug in selectedMaterials ? ' âœ…' : '' }}
        </a>
        {% if materialCategory.slug in selectedMaterials -%}
          {%- set materialParams = selectedMaterials|filter(s => s != materialCategory.slug) -%}
          {%- set filterParams = urlFilterParams|merge({ material: materialParams }) -%}
          <a class="absolute right-0 top-0 mr-2" href="{{ _macros.filterSiteUrl(url, filterParams) }}">x</a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% endif %}
